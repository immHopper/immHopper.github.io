<!DOCTYPE html>
<html lang=en>
  <head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="前言 再次学习，希望在对整个 PHP 反序列化漏洞的剖析学习过程中对其有更深入的理解，以便能更深入的利用  刨根知底：什么是序列化和什么是反序列化序列化与JSON数据类型的对比首先，我们先来看看JSON 数据类型是什么样的？ 1&amp;#123;&quot;name&quot;:&quot;Hopper&quot;,&quot;age&quot;:18,&quot;hobby&quot;:&quot;c">
<meta property="og:type" content="article">
<meta property="og:title" content="记一次再学习，深入理解 PHP反序列化漏洞学习和总结">
<meta property="og:url" content="http://example.com/2021/05/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20PHP-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/index.html">
<meta property="og:site_name" content="PcHunter">
<meta property="og:description" content="前言 再次学习，希望在对整个 PHP 反序列化漏洞的剖析学习过程中对其有更深入的理解，以便能更深入的利用  刨根知底：什么是序列化和什么是反序列化序列化与JSON数据类型的对比首先，我们先来看看JSON 数据类型是什么样的？ 1&amp;#123;&quot;name&quot;:&quot;Hopper&quot;,&quot;age&quot;:18,&quot;hobby&quot;:&quot;c">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://i.imgtg.com/2022/05/07/ztObi.png">
<meta property="og:image" content="https://i.imgtg.com/2022/05/07/ztx6q.png">
<meta property="og:image" content="https://i.imgtg.com/2022/05/07/ztiYM.png">
<meta property="og:image" content="https://i.imgtg.com/2022/05/07/z4pzv.png">
<meta property="og:image" content="https://i.imgtg.com/2022/05/07/z4tTr.png">
<meta property="og:image" content="https://i.imgtg.com/2022/05/07/z44vM.png">
<meta property="og:image" content="https://i.imgtg.com/2022/05/08/z4QuF.png">
<meta property="og:image" content="https://i.imgtg.com/2022/05/08/z4uPC.png">
<meta property="og:image" content="https://i.imgtg.com/2022/05/08/zDaax.png">
<meta property="og:image" content="https://i.imgtg.com/2023/04/11/8BvZI.png">
<meta property="og:image" content="https://i.imgtg.com/2023/04/11/8BycD.png">
<meta property="article:published_time" content="2021-05-07T06:51:18.000Z">
<meta property="article:modified_time" content="2023-09-20T07:56:42.772Z">
<meta property="article:author" content="瘦子先升">
<meta property="article:tag" content="PHP反序列化漏洞">
<meta property="article:tag" content="PHP">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.imgtg.com/2022/05/07/ztObi.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>记一次再学习，深入理解 PHP反序列化漏洞学习和总结</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
      <link rel="alternate" href="/true" title="PcHunter" type="application/atom+xml" />
    
    <!-- umami web analytics -->
    <script async defer data-website-id="ef8530fb-8585-46e1-aba4-f66f53625458" src="http://csl.cool:3000/umami.js"></script>
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.css" />
    
<meta name="generator" content="Hexo 6.3.0"></head>


  <body class="max-width mx-auto px3 ltr">
    
    <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/archives/">Archives</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2021/05/10/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%A9%E7%94%A8-POP%E9%93%BE%E6%9E%84%E9%80%A0/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2021/05/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20PHP-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2021/05/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20PHP-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/&text=记一次再学习，深入理解 PHP反序列化漏洞学习和总结"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2021/05/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20PHP-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/&title=记一次再学习，深入理解 PHP反序列化漏洞学习和总结"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2021/05/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20PHP-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/&is_video=false&description=记一次再学习，深入理解 PHP反序列化漏洞学习和总结"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=记一次再学习，深入理解 PHP反序列化漏洞学习和总结&body=Check out this article: http://example.com/2021/05/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20PHP-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2021/05/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20PHP-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/&title=记一次再学习，深入理解 PHP反序列化漏洞学习和总结"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2021/05/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20PHP-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/&title=记一次再学习，深入理解 PHP反序列化漏洞学习和总结"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2021/05/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20PHP-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/&title=记一次再学习，深入理解 PHP反序列化漏洞学习和总结"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2021/05/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20PHP-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/&title=记一次再学习，深入理解 PHP反序列化漏洞学习和总结"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2021/05/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20PHP-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/&name=记一次再学习，深入理解 PHP反序列化漏洞学习和总结&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2021/05/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20PHP-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/&t=记一次再学习，深入理解 PHP反序列化漏洞学习和总结"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A8%E6%A0%B9%E7%9F%A5%E5%BA%95%EF%BC%9A%E4%BB%80%E4%B9%88%E6%98%AF%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E4%BB%80%E4%B9%88%E6%98%AF%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">2.</span> <span class="toc-text">刨根知底：什么是序列化和什么是反序列化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8EJSON%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-number">2.1.</span> <span class="toc-text">序列化与JSON数据类型的对比</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PHP%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">3.</span> <span class="toc-text">PHP的序列化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E6%9D%83%E9%99%90%E9%97%AE%E9%A2%98"><span class="toc-number">3.1.</span> <span class="toc-text">PHP序列化的权限问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#public-%E6%9D%83%E9%99%90"><span class="toc-number">3.1.1.</span> <span class="toc-text">public 权限</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#private-%E6%9D%83%E9%99%90"><span class="toc-number">3.1.2.</span> <span class="toc-text">private 权限</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#protected-%E6%9D%83%E9%99%90"><span class="toc-number">3.1.3.</span> <span class="toc-text">protected 权限</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP-%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E6%B3%A8%E6%84%8F%E9%97%AE%E9%A2%98"><span class="toc-number">3.2.</span> <span class="toc-text">PHP 序列化的注意问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PHP-%E7%9A%84%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">4.</span> <span class="toc-text">PHP 的反序列化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81-PHP-%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%91%A2%EF%BC%9F"><span class="toc-number">5.</span> <span class="toc-text">为什么要 PHP 的序列化和反序列化呢？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PHP%E7%9A%84%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E"><span class="toc-number">6.</span> <span class="toc-text">PHP的反序列化漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%EF%BC%8C%E6%A6%82%E5%BF%B5%E8%A7%A3%E9%87%8A"><span class="toc-number">6.1.</span> <span class="toc-text">一，概念解释</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%EF%BC%8C%E5%B8%B8%E8%A7%81%E7%9A%84%E9%AD%94%E6%B3%95%E6%96%B9%E6%B3%95"><span class="toc-number">6.2.</span> <span class="toc-text">二，常见的魔法方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E6%8F%90%E5%88%B0%E8%BF%99%E4%BA%9B%E9%AD%94%E6%B3%95%E5%87%BD%E6%95%B0"><span class="toc-number">6.3.</span> <span class="toc-text">三，为什么需要提到这些魔法函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%EF%BC%8C%E8%B0%83%E7%94%A8%E9%AD%94%E6%B3%95%E5%87%BD%E6%95%B0%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-number">6.4.</span> <span class="toc-text">四，调用魔法函数的例子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%EF%BC%8C%E5%88%A9%E7%94%A8%E9%AD%94%E6%B3%95%E5%87%BD%E6%95%B0%E8%BF%9B%E8%A1%8C%E6%94%BB%E5%87%BB"><span class="toc-number">6.5.</span> <span class="toc-text">五，利用魔法函数进行攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E6%88%90-payload-%E4%BB%A3%E7%A0%81%EF%BC%9A"><span class="toc-number">6.5.1.</span> <span class="toc-text">生成 payload 代码：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0%EF%BC%9A"><span class="toc-number">6.6.</span> <span class="toc-text">参考文章：</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
      
      <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        记一次再学习，深入理解 PHP反序列化漏洞学习和总结
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">瘦子先升</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2021-05-07T06:51:18.000Z" itemprop="datePublished">2021-05-07</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/PHP/" rel="tag">PHP</a>, <a class="tag-link-link" href="/tags/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/" rel="tag">PHP反序列化漏洞</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote>
<p>再次学习，希望在对整个 PHP 反序列化漏洞的剖析学习过程中对其有更深入的理解，以便能更深入的利用</p>
</blockquote>
<h2 id="刨根知底：什么是序列化和什么是反序列化"><a href="#刨根知底：什么是序列化和什么是反序列化" class="headerlink" title="刨根知底：什么是序列化和什么是反序列化"></a>刨根知底：什么是序列化和什么是反序列化</h2><h3 id="序列化与JSON数据类型的对比"><a href="#序列化与JSON数据类型的对比" class="headerlink" title="序列化与JSON数据类型的对比"></a>序列化与JSON数据类型的对比</h3><p>首先，我们先来看看JSON 数据类型是什么样的？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;name&quot;:&quot;Hopper&quot;,&quot;age&quot;:18,&quot;hobby&quot;:&quot;code&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>我们可以看到不同组数据之间都是使用逗号分隔，每组数据内部使用冒号分隔键和值，整体看上去是一个字符串的样子，那么他原来的面目是什么呢？</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$arr</span> = <span class="keyword">array</span>(<span class="string">&quot;name&quot;</span> =&gt; <span class="string">&quot;Hopper&quot;</span>,<span class="string">&quot;age&quot;</span> =&gt; <span class="number">18</span>, <span class="string">&quot;hobby&quot;</span> =&gt; <span class="string">&quot;code&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$arr</span>);</span><br></pre></td></tr></table></figure>

<p>可以看到，这个 json 字符串后面的代码是一个数组，但是通常情况下为了前后端之间的传输方便我们将其 json_encode 了，然后我们后端如果接受到这个 json 数据，还能在 json_decode 回来，再通俗一点就是某些时候，不支持直接传输文件夹，我们必须要压缩一下然后传输，对方接收到需要解压才能看到你的数据，那么这种将原本的数据通过某种手段进行“压缩”，并且按照一定的格式存储的过程就可以称之为序列化</p>
<blockquote>
<p>那同样类比，什么是PHP的序列化呢</p>
</blockquote>
<h2 id="PHP的序列化"><a href="#PHP的序列化" class="headerlink" title="PHP的序列化"></a>PHP的序列化</h2><p>PHP 的所谓的序列化也是一个将各种类型的数据，压缩并按照一定格式存储的过程，他所使用的函数是serialize() ,我们来看下面的实例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$flag</span> = <span class="string">&quot;Inactive&quot;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$test</span> = <span class="string">&quot;test&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$test1</span> = <span class="string">&quot;test1&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">set_flag</span>(<span class="params"><span class="variable">$flag</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;flag = <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_flag</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$object</span> = <span class="keyword">new</span> <span class="title function_ invoke__">test</span>();</span><br><span class="line"><span class="variable">$object</span>-&gt;<span class="title function_ invoke__">set_flag</span>(<span class="string">&#x27;Inactive&#x27;</span>);</span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$object</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$data</span>;</span><br></pre></td></tr></table></figure>

<p>这是一个简单的 php 类，然后我们实例化以后对其属性进行了赋值，然后调用了 serialize() 并且输出，我们看一下输出的结果</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">&quot;test&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">10</span>:<span class="string">&quot; test flag&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;Inactive&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot; * test&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;test&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;test1&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;test1&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里属性名和属性值的格式与前面对象名的格式类似</p>
</blockquote>
<p><a data-fancybox="gallery" data-src="https://i.imgtg.com/2022/05/07/ztObi.png" data-caption="ztObi.png"><img src="https://i.imgtg.com/2022/05/07/ztObi.png" alt="ztObi.png"></a></p>
<h3 id="PHP序列化的权限问题"><a href="#PHP序列化的权限问题" class="headerlink" title="PHP序列化的权限问题"></a>PHP序列化的权限问题</h3><blockquote>
<p><strong>注意：这里有个非常重要的点</strong></p>
</blockquote>
<ol>
<li>细心的你，可能会注意到一个小问题，按照我前面对象名的格式算的话你可能会发现后面的属性名有些出路，</li>
<li>如：我代码里面明明写的是 flag 属性，序列化以后却变成了 testflag ，而且前面说好的长度也不一样了，testflag<br>明明是8个字符，到你这里却成了10个，除此之外后面的 test 属性也“变异了”，前面多了个（*）并且长度也不对，这到底是怎么回事？</li>
</ol>
<p>当你发现这个问题，那么说明你认真地思考了，这其实涉及到了 PHP 的属性的访问权限问题，序列化为了能把整个类对象的各种信息完完整整的压缩，格式化，必然也会将属性的权限序列化进去，我们发现我定义的类的属性有三种 private protected 和 默认的 public(写不写都一样)，其中</p>
<p><strong>(1)Puiblic 权限：</strong></p>
<p>他的序列化规规矩矩，按照我们常规的思路，该是几个字符就是几个字符，你看那个 test1 属性，就正如这样</p>
<br>

<p><strong>(2)Private 权限：</strong></p>
<p>该权限是私有权限，也就是说只能 test类使用，于是乎 test 有着强烈的占有欲，于是在序列化的时候一定要在 private 属性前面加上自己的名字，向世界表明这个属性是我独自占有的，但是好像长度还是不对，还少了两个，这是怎么回事？</p>
<p>那我们将其序列化的结果存入一个文件中，我们使用 Hexdump 看一下内部的结构，为了去除浏览器对整个过程的影响我修改一下代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$flag</span> = <span class="string">&quot;Inactive&quot;</span>;</span><br><span class="line">    <span class="keyword">protected</span>  <span class="variable">$test</span> = <span class="string">&quot;test&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$test1</span> = <span class="string">&quot;test1&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$object</span> = <span class="keyword">new</span> <span class="title function_ invoke__">test</span>();</span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$object</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$data</span></span><br></pre></td></tr></table></figure>

<br>

<h4 id="public-权限"><a href="#public-权限" class="headerlink" title="public 权限"></a>public 权限</h4><p>输出前后一样</p>
<br>

<h4 id="private-权限"><a href="#private-权限" class="headerlink" title="private 权限"></a>private 权限</h4><p><a data-fancybox="gallery" data-src="https://i.imgtg.com/2022/05/07/ztx6q.png" data-caption="ztx6q.png"><img src="https://i.imgtg.com/2022/05/07/ztx6q.png" alt="ztx6q.png"></a></p>
<p>我们看到 test 的前后出现了两个 %00 ，也就是空白符，现在是不是字符数也凑够了？那么现在请记住这个规定，在私有属性序列化的时候格式是</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%<span class="number">00</span>类名%<span class="number">00</span>属性名</span><br></pre></td></tr></table></figure>

<br>

<h4 id="protected-权限"><a href="#protected-权限" class="headerlink" title="protected 权限"></a>protected 权限</h4><p>我们直接看看 hexdump 的结果</p>
<p><a data-fancybox="gallery" data-src="https://i.imgtg.com/2022/05/07/ztiYM.png" data-caption="ztiYM.png"><img src="https://i.imgtg.com/2022/05/07/ztiYM.png" alt="ztiYM.png"></a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%<span class="number">00</span>*%<span class="number">00</span>属性名</span><br></pre></td></tr></table></figure>

<br>





<h3 id="PHP-序列化的注意问题"><a href="#PHP-序列化的注意问题" class="headerlink" title="PHP 序列化的注意问题"></a>PHP 序列化的注意问题</h3><blockquote>
<p>注意的点</p>
</blockquote>
<p>如果你再细致一点，你可能会发现这样一个问题，你这个类定义了那么多方法，怎么把对象序列化了以后全都丢了？你看你整个序列化的字符串里面全是属性，就没有一个方法，这是为什么？</p>
<p><strong>请记住，序列化他只序列化属性，不序列化方法，这个性质就引出了两个非常重要的话题：</strong></p>
<br>

<p><strong>(1)我们在反序列化的时候一定要保证在当前的作用域环境下有该类存在</strong></p>
<p>这里不得不扯出反序列化的问题，这里先简单说一下，反序列化就是将我们压缩格式化的对象还原成初始状态的过程（可以认为是解压缩的过程），因为我们没有序列化方法，因此在反序列化以后我们如果想正常使用这个对象的话我们必须要依托于这个类要在当前作用域存在的条件。</p>
<p><strong>(2)我们在反序列化攻击的时候也就是依托类属性进行攻击</strong></p>
<p>因为没有序列化方法嘛，我们能控制的只有类的属性，因此类属性就是我们唯一的攻击入口，在我们的攻击流程中，我们就是要寻找合适的能被我们控制的属性，然后利用它本身的存在的方法，在基于属性被控制的情况下发动我们的发序列化攻击（这是我们攻击的核心思想，这里先借此机会抛出来，有一个印象）</p>
<h2 id="PHP-的反序列化"><a href="#PHP-的反序列化" class="headerlink" title="PHP 的反序列化"></a>PHP 的反序列化</h2><p><strong>有序列化 化对象为压缩格式化的字符串，就有反序列化，将压缩格式化的字符串还原</strong></p>
<p>我们还是沿用上面的代码，我现在将 serialize.txt 里面的内容进行反序列化，并输出对应属性的值</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$flag</span> = <span class="string">&quot;Inactive&quot;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$test</span> = <span class="string">&quot;test&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$test1</span> = <span class="string">&quot;test1&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">set_flag</span>(<span class="params"><span class="variable">$flag</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;flag = <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_flag</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;serialize.txt&quot;</span>);</span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$data</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$data</span>-&gt;test1.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$data</span>-&gt;<span class="title function_ invoke__">get_flag</span>();</span><br></pre></td></tr></table></figure>

<p>serialize.txt 保存的是PHP序列化的内容：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">&quot;test&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">10</span>:<span class="string">&quot; test flag&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;Inactive&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot; * test&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;test&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;test1&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;test1&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>



<p>PHP反序列化后输出的结果：</p>
<p><a data-fancybox="gallery" data-src="https://i.imgtg.com/2022/05/07/z4pzv.png" data-caption="z4pzv.png"><img src="https://i.imgtg.com/2022/05/07/z4pzv.png" alt="z4pzv.png"></a></p>
<p>我们可以看到本来存储在文件中的一串字符，在 uiseralize() 的作用下还原成了对象，并且实现了 属性和方法的调用</p>
<blockquote>
<p>那试想下，某人想使坏，在电脑主人不知道的情况下悄悄改了这个 serialize.txt 的内容，改成了下面这样<strong>（注意红色方框的部分）</strong></p>
</blockquote>
<p><a data-fancybox="gallery" data-src="https://i.imgtg.com/2022/05/07/z4tTr.png" data-caption="z4tTr.png"><img src="https://i.imgtg.com/2022/05/07/z4tTr.png" alt="z4tTr.png"></a></p>
<p>那反序列化的结果就与之前的结果完全不一样</p>
<p><a data-fancybox="gallery" data-src="https://i.imgtg.com/2022/05/07/z44vM.png" data-caption="z44vM.png"><img src="https://i.imgtg.com/2022/05/07/z44vM.png" alt="z44vM.png"></a></p>
<p>看到这里，其实就是我们反序列化攻击的原理的核心内容</p>
<br>



<h2 id="为什么要-PHP-的序列化和反序列化呢？"><a href="#为什么要-PHP-的序列化和反序列化呢？" class="headerlink" title="为什么要 PHP 的序列化和反序列化呢？"></a>为什么要 PHP 的序列化和反序列化呢？</h2><p>其实这个问题和前面的 json 是为了传递数据的方便性是类似的：</p>
<p>当然，传递数据的方便肯定是这种压缩并格式化存储的一大共同的属性，那么序列化除了这种属性以外还有什么特性呢？要是只是这样那干脆不如直接用 json 好了，当然有，从上面的实验中你没发现吗？我们把一个实例化的对象长久地存储在了计算机的磁盘上，无论什么时候调用都能恢复原来的样子，这其实是为了解决 PHP 对象传递的一个问题,因为 PHP 文件在执行结束以后就会将对象销毁，那么如果下次有一个页面恰好要用到刚刚销毁的对象就会束手无策，总不能你永远不让它销毁，等着你吧，于是人们就想出了一种能长久保存对象的方法，这就是 PHP 的序列化，那当我们下次要用的时候只要反序列化一下就 ok 了，这就方便了很多。</p>
<br>

<h2 id="PHP的反序列化漏洞"><a href="#PHP的反序列化漏洞" class="headerlink" title="PHP的反序列化漏洞"></a>PHP的反序列化漏洞</h2><h3 id="一，概念解释"><a href="#一，概念解释" class="headerlink" title="一，概念解释"></a>一，概念解释</h3><p>PHP 反序列化漏洞又叫做 PHP 对象注入漏洞，这种叫法本质来讲挺偏的，也不能说明根本的问题，通过上面的验证，我们可以知道其实主要是在于它的对象属性被篡改，所以叫 PHP 对象的属性篡改漏洞更好…(gege~~)</p>
<p>反序列化漏洞的成因在于代码中的 unserialize() 接收的参数可控，从上面的例子看，这个函数的参数是一个序列化的对象，而序列化的对象只含有对象的属性，那我们就要利用对对象属性的篡改实现最终的攻击。</p>
<br>

<h3 id="二，常见的魔法方法"><a href="#二，常见的魔法方法" class="headerlink" title="二，常见的魔法方法"></a>二，常见的魔法方法</h3><p>这里就不得不介绍几个我们必须知道的魔法方法了</p>
<ol>
<li><strong>construct()：</strong>   当对象创建时会自动调用(但在unserialize()时是不会自动调用的)。</li>
<li><strong>wakeup() ：</strong>  unserialize()时会自动调用</li>
<li><strong>destruct()：</strong>  当对象被销毁时会自动调用</li>
<li><strong>toString()</strong>:     当反序列化后的对象被输出在模板中的时候（转换成字符串的时候）自动调用</li>
<li><strong>get()</strong> :       当从不可访问的属性读取数据</li>
<li><strong>call()</strong>:       在对象上下文中调用不可访问的方法时触发</li>
</ol>
<blockquote>
<p>特别强调一下第四点</p>
</blockquote>
<p>这个 __toString 触发的条件比较多，也因为这个原因容易被忽略，常见的触发条件有下面几种</p>
<p>(1)echo (<code>$obj</code>) &#x2F; print(<code>$obj</code>) 打印时会触发</p>
<p>(2)反序列化对象与字符串连接时</p>
<p>(3)反序列化对象参与格式化字符串时</p>
<p>(4)反序列化对象与字符串进行&#x3D;&#x3D;比较时（PHP进行&#x3D;&#x3D;比较的时候会转换参数类型）</p>
<p>(5)反序列化对象参与格式化SQL语句，绑定参数时</p>
<p>(6)反序列化对象在经过php字符串函数，如 strlen()、addslashes()时</p>
<p>(7)在in_array()方法中，第一个参数是反序列化对象，第二个参数的数组中有<strong>toString返回的字符串的时候</strong>toString会被调用</p>
<p>(8)反序列化的对象作为 class_exists() 的参数的时候</p>
<br>

<h3 id="三，为什么需要提到这些魔法函数"><a href="#三，为什么需要提到这些魔法函数" class="headerlink" title="三，为什么需要提到这些魔法函数"></a>三，为什么需要提到这些魔法函数</h3><p>为什么要提到这些魔法方法？你看上面的实现的最简单的攻击不是也没有用到魔法方法吗？</p>
<p>我们上面讲过，在我们的攻击中，反序列化函数 unserialize() 是我们攻击的入口，也就是说，只要这个参数可控，我们就能传入任何的已经序列化的对象（只要这个类在当前作用域存在我们就可以利用），而不是局限于出现 unserialize() 函数的类的对象，如果只能局限于当前类，那我们的攻击面也太狭小了，这个类不调用危险的方法我们就没法发起攻击。</p>
<p>但是我们又知道，你反序列化了其他的类对象以后我们只是控制了是属性，如果你没有在完成反序列化后的代码中调用其他类对象的方法，我们还是束手无策，毕竟代码是人家写的，人家本身就是要反序列化后调用该类的某个安全的方法，你总不能改人家的代码吧，但是没关系，因为我们有魔法方法。</p>
<p>魔法正如上面介绍的，魔法方法的调用是在该类序列化或者反序列化的同时自动完成的，不需要人工干预，这就非常符合我们的想法，因此只要魔法方法中出现了一些我们能利用的函数，我们就能通过反序列化中对其对象属性的操控来实现对这些函数的操控，进而达到我们发动攻击的目的。</p>
<br>



<h3 id="四，调用魔法函数的例子"><a href="#四，调用魔法函数的例子" class="headerlink" title="四，调用魔法函数的例子"></a>四，调用魔法函数的例子</h3><p>我们来看一个反序列化的案例，加强一下我们对这个魔法方法的理解</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">hopper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$name</span> = <span class="string">&quot;hopper&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__construct&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__sleep&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__wakeup&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__destruct&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;__toString&quot;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$hopper_old</span> = <span class="keyword">new</span> hopper;</span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$hopper_old</span>);</span><br><span class="line"><span class="variable">$hopper_new</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$data</span>);</span><br><span class="line"><span class="keyword">print</span>(<span class="variable">$hopper_new</span>);</span><br></pre></td></tr></table></figure>

<p>测试的结果：</p>
<p><a data-fancybox="gallery" data-src="https://i.imgtg.com/2022/05/08/z4QuF.png" data-caption="z4QuF.png"><img src="https://i.imgtg.com/2022/05/08/z4QuF.png" alt="z4QuF.png"></a></p>
<p>根据上面说的魔法方法的触发规则分析一下这个结果是怎么来的，这里 __destruct 了两次说明当前实际上有两个对象，一个就是实例化的时候创建的对象，另一个就是反序列化后生成的对象。</p>
<h3 id="五，利用魔法函数进行攻击"><a href="#五，利用魔法函数进行攻击" class="headerlink" title="五，利用魔法函数进行攻击"></a>五，利用魔法函数进行攻击</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hopper</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$test</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Hopper</span> = <span class="string">&quot;i am Hopper&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;test = <span class="keyword">new</span> <span class="title function_ invoke__">L</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;test-&gt;<span class="title function_ invoke__">action</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">L</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">action</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Welcome to XDSEC&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Evil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$test2</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">action</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;test2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;test&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>我们先来分析一下这段代码，首先我们能看到 unserialize() 函数的参数我们是可以控制的，也就是说我们能通过这个接口反序列化任何类的对象(但只有在当前作用域的类才对我们有用)，那我们看一下当前这三个类，我们看到后面两个类反序列化以后对我们没有任何意义，因为我们根本没法调用其中的方法，但是第一个类就不一样了，虽然我们也没有什么代码能实现调用其中的方法的，但是我们发现他有一个魔法函数 __destruct() ，这就非常有趣了，因为这个函数能在对象销毁的时候自动调用，不用我们人工的干预，好，既然这样我们就决定反序列化这个类的对象了，接下来让我们看一下怎么利用(我上面说过了，我们需要控制这个类的某些属性，通过控制属性实现我们的攻击)</p>
<p>那我们看一下哪些属性的控制是对我们有用的(这个时候我们就跳过了<strong>construct() 方法，毕竟他永远不会被调用)，因为这个例子比较简单，</strong>destruct() 里面只用到了一个属性 test ，那肯定就是他了，那我们控制这个属性为什么内容我们就能攻击了呢，我们再观察一下 那些地方调用了 action() 函数，看看这个函数的调用中有没有存在执行命令或者是其他我们能利用的点的，果然我们在 Evil 这个类中发现他的 action() 函数调用了 eval(),那我们的想法就很明确了，我们需要将 Hopper 这个类中的 test 属性篡改为 Evil 这个类的对象，然后为了 eval 能执行命令，我们还要篡改 Evil 对象的 test2 属性，将其改成我们的 Payload</p>
<p>分析完毕以后我们就可以构建我们的序列化字符串了，构建的方法不是手写(我们要将这段代码复制一下，然后修改一些内容并进行序列化操作)</p>
<h4 id="生成-payload-代码："><a href="#生成-payload-代码：" class="headerlink" title="生成 payload 代码："></a><strong>生成 payload 代码：</strong></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hopper</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$test</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;test = <span class="keyword">new</span> <span class="title class_">Evil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Evil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$test2</span> = <span class="string">&quot;phpinfo();&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$Hopper</span> = <span class="keyword">new</span> <span class="title class_">Hopper</span>;</span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$Hopper</span>);</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;seria.txt&quot;</span>, <span class="variable">$data</span>);</span><br></pre></td></tr></table></figure>

<p>我们去除了一切与我们要篡改的属性无关的内容，对其进行序列化操作，然后将序列化的结果复制出来，想刚刚的代码发起请求</p>
<p><a data-fancybox="gallery" data-src="https://i.imgtg.com/2022/05/08/z4uPC.png" data-caption="z4uPC.png"><img src="https://i.imgtg.com/2022/05/08/z4uPC.png" alt="z4uPC.png"></a></p>
<p>把这段payload 传送过去：</p>
<p><a data-fancybox="gallery" data-src="https://i.imgtg.com/2022/05/08/zDaax.png" data-caption="zDaax.png"><img src="https://i.imgtg.com/2022/05/08/zDaax.png" alt="zDaax.png"></a></p>
<p>可以看到我们攻击成功，特别要提醒一下的就是我在图中框起来的部分，上面说过由于是私有属性，他有自己特殊的格式会在前后加两个 %00 ，所以我们在传输过程中不能忘掉</p>
<p><a data-fancybox="gallery" data-src="https://i.imgtg.com/2023/04/11/8BvZI.png" data-caption=""><img src="https://i.imgtg.com/2023/04/11/8BvZI.png"></a></p>
<p><a data-fancybox="gallery" data-src="https://i.imgtg.com/2023/04/11/8BycD.png" data-caption=""><img src="https://i.imgtg.com/2023/04/11/8BycD.png"></a></p>
<p>通过上面案列，可知如果存在一些可执行命令的函数时，充分利用魔法函数去构造是可以去RCE的</p>
<p><strong>通过这个简单的例子总结一下寻找 PHP 反序列化漏洞的方法或者说流程</strong></p>
<ol>
<li>寻找 unserialize() 函数的参数是否有我们的可控点</li>
<li>寻找我们的反序列化的目标，重点寻找 存在 <strong>wakeup() 或</strong> destruct() 魔法函数的类</li>
<li>一层一层地研究该类在魔法方法中使用的属性和属性调用的方法，看看是否有可控的属性能实现在当前调用的过程中触发的</li>
<li>找到我们要控制的属性了以后我们就将要用到的代码部分复制下来，然后构造序列化，发起攻击</li>
</ol>
<h3 id="参考文章："><a href="#参考文章：" class="headerlink" title="参考文章："></a>参考文章：</h3><p><a target="_blank" rel="noopener" href="https://www.k0rz3n.com/2018/11/19/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">https://www.k0rz3n.com/2018/11/19/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/</a></p>

  </div>
</article>



<div>    
  <ul class="post-copyright">
     <li class="post-copyright-link">
      <strong>本文作者：</strong>
      <a href="/">瘦子先升</a>
    </li>
    <li class="post-copyright-link">
      <strong>本文标题：</strong>
      <a href="{{ url_for(config.permalink) }}">
    
        <a class="" href="/2021/05/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20PHP-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/">记一次再学习，深入理解 PHP反序列化漏洞学习和总结</a>
        <div class="post-mark-list">
    
</div> 
    


</a>
    </li>
    <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a title="记一次再学习，深入理解 PHP反序列化漏洞学习和总结">http://example.com/2021/05/07/记一次深入理解 PHP-反序列化漏洞学习/</a>
    </li>
    <li class="post-copyright-license">
      <strong>版权声明： </strong>
      本文由 瘦子先升 原创，采用 <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh" title="Attribution-NonCommercial-NoDerivatives 4.0 International" rel="license" target="_blank">CC BY-NC-ND 4.0</a>, 转载请保留以上声明信息！
    </li>
  </ul>
</div>

      
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/archives/">Archives</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A8%E6%A0%B9%E7%9F%A5%E5%BA%95%EF%BC%9A%E4%BB%80%E4%B9%88%E6%98%AF%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E4%BB%80%E4%B9%88%E6%98%AF%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">2.</span> <span class="toc-text">刨根知底：什么是序列化和什么是反序列化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8EJSON%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-number">2.1.</span> <span class="toc-text">序列化与JSON数据类型的对比</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PHP%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">3.</span> <span class="toc-text">PHP的序列化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E6%9D%83%E9%99%90%E9%97%AE%E9%A2%98"><span class="toc-number">3.1.</span> <span class="toc-text">PHP序列化的权限问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#public-%E6%9D%83%E9%99%90"><span class="toc-number">3.1.1.</span> <span class="toc-text">public 权限</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#private-%E6%9D%83%E9%99%90"><span class="toc-number">3.1.2.</span> <span class="toc-text">private 权限</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#protected-%E6%9D%83%E9%99%90"><span class="toc-number">3.1.3.</span> <span class="toc-text">protected 权限</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP-%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E6%B3%A8%E6%84%8F%E9%97%AE%E9%A2%98"><span class="toc-number">3.2.</span> <span class="toc-text">PHP 序列化的注意问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PHP-%E7%9A%84%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">4.</span> <span class="toc-text">PHP 的反序列化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81-PHP-%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%91%A2%EF%BC%9F"><span class="toc-number">5.</span> <span class="toc-text">为什么要 PHP 的序列化和反序列化呢？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PHP%E7%9A%84%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E"><span class="toc-number">6.</span> <span class="toc-text">PHP的反序列化漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%EF%BC%8C%E6%A6%82%E5%BF%B5%E8%A7%A3%E9%87%8A"><span class="toc-number">6.1.</span> <span class="toc-text">一，概念解释</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%EF%BC%8C%E5%B8%B8%E8%A7%81%E7%9A%84%E9%AD%94%E6%B3%95%E6%96%B9%E6%B3%95"><span class="toc-number">6.2.</span> <span class="toc-text">二，常见的魔法方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E6%8F%90%E5%88%B0%E8%BF%99%E4%BA%9B%E9%AD%94%E6%B3%95%E5%87%BD%E6%95%B0"><span class="toc-number">6.3.</span> <span class="toc-text">三，为什么需要提到这些魔法函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%EF%BC%8C%E8%B0%83%E7%94%A8%E9%AD%94%E6%B3%95%E5%87%BD%E6%95%B0%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-number">6.4.</span> <span class="toc-text">四，调用魔法函数的例子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%EF%BC%8C%E5%88%A9%E7%94%A8%E9%AD%94%E6%B3%95%E5%87%BD%E6%95%B0%E8%BF%9B%E8%A1%8C%E6%94%BB%E5%87%BB"><span class="toc-number">6.5.</span> <span class="toc-text">五，利用魔法函数进行攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E6%88%90-payload-%E4%BB%A3%E7%A0%81%EF%BC%9A"><span class="toc-number">6.5.1.</span> <span class="toc-text">生成 payload 代码：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0%EF%BC%9A"><span class="toc-number">6.6.</span> <span class="toc-text">参考文章：</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2021/05/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20PHP-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2021/05/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20PHP-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/&text=记一次再学习，深入理解 PHP反序列化漏洞学习和总结"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2021/05/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20PHP-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/&title=记一次再学习，深入理解 PHP反序列化漏洞学习和总结"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2021/05/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20PHP-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/&is_video=false&description=记一次再学习，深入理解 PHP反序列化漏洞学习和总结"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=记一次再学习，深入理解 PHP反序列化漏洞学习和总结&body=Check out this article: http://example.com/2021/05/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20PHP-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2021/05/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20PHP-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/&title=记一次再学习，深入理解 PHP反序列化漏洞学习和总结"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2021/05/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20PHP-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/&title=记一次再学习，深入理解 PHP反序列化漏洞学习和总结"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2021/05/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20PHP-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/&title=记一次再学习，深入理解 PHP反序列化漏洞学习和总结"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2021/05/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20PHP-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/&title=记一次再学习，深入理解 PHP反序列化漏洞学习和总结"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2021/05/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20PHP-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/&name=记一次再学习，深入理解 PHP反序列化漏洞学习和总结&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2021/05/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20PHP-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/&t=记一次再学习，深入理解 PHP反序列化漏洞学习和总结"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

      <div id="end">
    <img src="/images/post-end.png" alt="">
</div> 
      
      
      <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2023 瘦子先升
    <a target="_blank" rel="noopener" href="http://www.beian.miit.gov.cn/">京ICP备20001935号-1</a>
    <div id="friend-link-container">
      友情连接: 
      
    </div>
  </div>
  
    <div class="footer-right">
      <nav>
        <ul>
          
      <li><a href="/">Home</a></li>
      
      <li><a href="/search/">Search</a></li>
      
      <li><a href="/categories/">Categories</a></li>
      
      <li><a href="/archives/">Archives</a></li>
      
      <li><a href="/about/">About</a></li>
      
      </ul>
      </nav>
    </div>
  
</footer>
    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

  <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?c2fdf3bebd0db8e40c37a4f37d76d33b";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
        </script>

<!-- Umami Analytics -->

<!-- Disqus Comments -->



<!-- FancyBox -->

  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js"></script>
  


    
  </body>

  </html>